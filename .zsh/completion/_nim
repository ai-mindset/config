#compdef nim

_nim() {
  local context state line

  _arguments -C \
    '1: :_nim_commands' \
    '*::arg:->args' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '(-v --version)'{-v,--version}'[Show version]' \
    '(-p --path)'{-p,--path}'[Add path to search paths]:path:_files -/' \
    '(-d --define)'{-d,--define}'[Define a conditional symbol]:symbol:' \
    '(-u --undef)'{-u,--undef}'[Undefine a conditional symbol]:symbol:' \
    '--opt[Set optimization level]:level:(none speed size)' \
    '--backend[Choose backend]:backend:(c cpp objc js)' \
    '--mm[Set memory management]:memory:(refc arc orc)' \
    '--gc[Set garbage collector]:gc:(refc markAndSweep boehm go none regions)' \
    '--threads[Enable thread support]:threads:(on off)' \
    '--app[Set application type]:type:(console gui lib staticlib)' \
    '--cpu[Set target CPU]:cpu:(i386 amd64 arm arm64)' \
    '--os[Set target OS]:os:(linux windows macosx freebsd openbsd netbsd solaris haiku)' \
    '--checks[Enable runtime checks]:checks:(on off)' \
    '--assertions[Enable assertions]:assertions:(on off)' \
    '--lineTrace[Enable line tracing]:lineTrace:(on off)' \
    '--debuginfo[Enable debug info]:debuginfo:(on off)' \
    '--debugger[Set debugger]:debugger:(native gdb lldb)' \
    '--profiler[Enable profiler]:profiler:(on off)' \
    '--stackTrace[Enable stack traces]:stackTrace:(on off)' \
    '--linetrace[Enable line tracing]:linetrace:(on off)' \
    '--verbosity[Set verbosity level]:level:(0 1 2 3)' \
    '--out[Set output filename]:file:_files' \
    '--outdir[Set output directory]:dir:_files -/' \
    '--nimcache[Set nimcache directory]:dir:_files -/'

  case $state in
  args)
    case ${line[1]} in
    compile|c|cc|cpp|objc|js)
      _arguments \
        '*:nim file:_files -g "*.nim"'
      ;;
    r|run)
      _arguments \
        '1:nim file:_files -g "*.nim"' \
        '*:program arguments:'
      ;;
    doc|doc2)
      _arguments \
        '*:nim file:_files -g "*.nim"'
      ;;
    check)
      _arguments \
        '*:nim file:_files -g "*.nim"'
      ;;
    *)
      _arguments \
        '*:file:_files'
      ;;
    esac
    ;;
  esac
}

_nim_commands() {
  local commands
  commands=(
    'compile:Compile project with default code generator (C)'
    'c:Compile project with default code generator (C)'
    'cc:Compile project with C++ code generator'
    'cpp:Compile project with C++ code generator'
    'objc:Compile project with Objective-C code generator'
    'js:Compile project with JavaScript code generator'
    'r:Compile to nimcache and run with arguments'
    'run:Compile to nimcache and run with arguments'
    'check:Check project for syntax and semantic errors'
    'parse:Parse project and output AST'
    'scan:Scan project and output tokens'
    'pretty:Pretty print the inputfile'
    'genDepend:Generate dependency information'
    'dump:Dump all defined conditionals and search paths'
    'doc:Generate documentation for inputfile'
    'doc2:Generate documentation with new doc generator'
    'rst2html:Convert RST file to HTML'
    'rst2tex:Convert RST file to TeX'
    'jsondoc:Extract documentation to JSON'
    'ctags:Generate ctags file'
    'idetools:IDE support tools'
  )
  _describe 'nim commands' commands
}

_nim "$@"